
<div class="container-fluid">

<button class="btn btn-info m-3">
  Draft new message
</button>

<!-- !!!!!!!!!!!!!!!!! PARENTS VERSION of dropdown to all teachers !!!!!!!!!!  -->
<div *ngIf="testRoleParent()">
<div class="m-3">
  <form class="form-control">
    <input
    class="form-control mb-3"
    type="text"
    name="content"
    placeholder="Enter message"
    [(ngModel)]="newMessage.content"
  />

  <label for="dropDown">To:</label>
  <select name="recipientUser" id="dropDown"
          [(ngModel)] = "newMessage.recipient.id">
    <option  *ngFor="let contact of teacherContacts"
            [value]="contact.id">
            {{contact.firstName}} {{contact.lastName}}
    </option>

  </select>
  <button class="btn btn-dark" (click)="createNewMessage(newMessage)">Send</button>
  </form>
</div>
</div>


<!-- !!!!!!!!!!!!!! TEACHERS VERSION of dropdown to all parents !!!!!!!!!!! -->
<div *ngIf="testRoleTeacher()">
  <div class="m-3">
    <form class="form-control">
      <input
      class="form-control mb-3"
      type="text"
      name="content"
      placeholder="Enter message"
      [(ngModel)]="newMessage.content"
    />

    <label for="dropDown">To:</label>
    <select name="recipientUser" id="dropDown"
            [(ngModel)] = "newMessage.recipient.id">

      <option  *ngFor="let contact of parentContacts"
              [value]="contact.id">
              {{contact.firstName}} {{contact.lastName}}
      </option>

    </select>
    <button class="btn btn-dark" (click)="createNewMessage(newMessage)">Send</button>
    </form>
  </div>
  </div>




<!-- MESSAGES
<div *ngFor="let message of messages">
  To : {{message.recipient.firstName}} <br>
  From : {{message.sender.firstName }} <br>
  {{message.content}}
  <br>
  <button class="btn btn-dark"
          (click)="selectedRecipient = message.sender; log('RECIPIENT'); log(message.sender);"
          (click)="loadReplyMessage(message)"
    >reply</button>

  <button class="btn btn-secondary"
          (click)="showAllReplies(message.id)"
  >see all</button>


  <hr>
</div>
-->

<!-- THREADS  -->
<h1>Direct Messages</h1>
<hr>

<!-- TOP LEVEL THREAD  -->
<div *ngIf="!selectedThread">
<div  *ngFor="let thread of threads">

  <div>
    To : {{thread[0].recipient.firstName}} <br>
    From : {{thread[0].sender.firstName }} <br>
    {{thread[0].content}}
  </div>

  <button *ngIf="fromSomeoneElse(thread[0])"
          class="btn btn-dark"
          (click)="selectedRecipient = thread[0].sender;"
          (click)="loadReplyMessage(thread[0])"
          (click)="open(newReplyFormModal)"
    >reply</button>
  <button class="btn btn-secondary"
  (click) = "selectedThread = thread"
  >see all</button>

  <button class="btn btn-light"

  (click) = "markAllAsRead(thread[0]); log(thread[0])"
  >mark all as read</button>
  <hr>
</div>

</div>

<!-- ALL SELECTED THREADS  -->
<div *ngIf="selectedThread">
  <button class="btn btn-secondary"
          (click)="selectedThread = null"> â‡¦ back</button>
  <div *ngFor="let message of selectedThread">
    <div>
      To : {{message.recipient.firstName}} <br>
      From : {{message.sender.firstName }} <br>
      {{message.content}}
      <hr>
    </div>

  </div>

</div>



  <!-- REPLY MODAL  -->
  <ng-template #newReplyFormModal let-modal>
    <div class="modal-header">
      <h4 class="modal-title" id="modal-basic-title">To: {{selectedRecipient?.firstName}}</h4>
      <button
        type="button"
        class="btn-close"
        aria-label="Close"
        (click)="modal.dismiss('Cross click')"
      ></button>
    </div>
    <div class="modal-body">
      <input
      class="form-control mb-3"
      type="text"
      name="content"
      placeholder="Enter message"
      [(ngModel)]="messageInReply.content"
    />
    </div>

    <div class="modal-footer">
      <button
        type="button"
        class="btn btn-outline-dark"
        (click)="
          modal.close(replyToMessage(messageInReply))
        "
      >
        Submit Edit
      </button>
    </div>
  </ng-template>

</div>
